CREATE TABLE balance_system (id BIGINT AUTO_INCREMENT, id_period BIGINT, deposit_standart DECIMAL(18, 2) NOT NULL, deposit_expert DECIMAL(18, 2) NOT NULL, deposit_super DECIMAL(18, 2) NOT NULL, deposit_user DECIMAL(18, 2) NOT NULL, charges_standart DECIMAL(18, 2) NOT NULL, charges_expert DECIMAL(18, 2) NOT NULL, charges_super DECIMAL(18, 2) NOT NULL, charges_user DECIMAL(18, 2) NOT NULL, in_balance_standart DECIMAL(18, 2) NOT NULL, in_balance_super DECIMAL(18, 2) NOT NULL, in_balance_expert DECIMAL(18, 2) NOT NULL, in_balance_user DECIMAL(18, 2) NOT NULL, sales_standart BIGINT NOT NULL, sales_super BIGINT NOT NULL, sales_expert BIGINT NOT NULL, to_pay_standart DECIMAL(18, 2) NOT NULL, to_pay_super DECIMAL(18, 2) NOT NULL, to_pay_expert DECIMAL(18, 2) NOT NULL, r2r_standart DECIMAL(18, 2) NOT NULL, r2r_super DECIMAL(18, 2) NOT NULL, r2r_expert DECIMAL(18, 2) NOT NULL, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, INDEX id_period_idx (id_period), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci ENGINE = INNODB;
CREATE TABLE balance_user (id BIGINT AUTO_INCREMENT, id_user BIGINT, id_period BIGINT, add_funds DECIMAL(18, 2) NOT NULL, use_payment DECIMAL(18, 2) NOT NULL, sell_purchase_cnt BIGINT NOT NULL, amount DECIMAL(18, 2) NOT NULL, payable DECIMAL(18, 2) NOT NULL, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, INDEX id_user_idx (id_user), INDEX id_period_idx (id_period), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci ENGINE = INNODB;
CREATE TABLE category (id BIGINT AUTO_INCREMENT, name_en VARCHAR(255) NOT NULL, name_ru VARCHAR(255) NOT NULL, ordered BIGINT DEFAULT 50 NOT NULL, is_free TINYINT(1) DEFAULT '0' NOT NULL, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci ENGINE = INNODB;
CREATE TABLE comment (id BIGINT AUTO_INCREMENT, id_paragraph BIGINT, comment_ru LONGTEXT NOT NULL, comment_en LONGTEXT NOT NULL, ordered INT DEFAULT 0 NOT NULL, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, INDEX id_paragraph_idx (id_paragraph), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci ENGINE = INNODB;
CREATE TABLE content (id BIGINT AUTO_INCREMENT, id_user BIGINT, id_category BIGINT, title_ru TEXT NOT NULL, title_en TEXT NOT NULL, author_ru VARCHAR(200) NOT NULL, author_en VARCHAR(200) NOT NULL, pretext_ru TEXT NOT NULL, pretext_en TEXT NOT NULL, photo_ru VARCHAR(200), photo_en VARCHAR(200), state VARCHAR(255) DEFAULT 'draft', is_blocked TINYINT(1) DEFAULT '0' NOT NULL, is_moderated TINYINT(1) DEFAULT '0' NOT NULL, to_delete TINYINT(1) DEFAULT '0' NOT NULL, pub_date DATE NOT NULL, letters_k BIGINT DEFAULT 0 NOT NULL, is_free TINYINT(1) DEFAULT '0' NOT NULL, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, INDEX state_id_user_idx_idx (state, id_user), INDEX id_user_idx (id_user), INDEX id_category_idx (id_category), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci ENGINE = INNODB;
CREATE TABLE content_purchase (id BIGINT AUTO_INCREMENT, id_user BIGINT, id_category BIGINT, id_content BIGINT, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, INDEX id_user_idx (id_user), INDEX id_category_idx (id_category), INDEX id_content_idx (id_content), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci ENGINE = INNODB;
CREATE TABLE user_group__user_permission (group_id BIGINT, permission_id BIGINT, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, PRIMARY KEY(group_id, permission_id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci ENGINE = INNODB;
CREATE TABLE user (id BIGINT AUTO_INCREMENT, salt VARCHAR(128), password VARCHAR(128), login VARCHAR(100) NOT NULL UNIQUE, email VARCHAR(80) NOT NULL UNIQUE, phone VARCHAR(20), first_name VARCHAR(80), last_name VARCHAR(80), live_place VARCHAR(255), site VARCHAR(255), account_number VARCHAR(20) NOT NULL, skype VARCHAR(40), resume_text TEXT, avatar VARCHAR(255), userpic VARCHAR(255), const_msg VARCHAR(255), activation_code VARCHAR(50) NOT NULL, active TINYINT(1) DEFAULT '0' NOT NULL, slug VARCHAR(255), utype VARCHAR(255) DEFAULT 'uuser', is_blocked TINYINT(1) DEFAULT '0' NOT NULL, tariff VARCHAR(255) DEFAULT 'none', tariff_change VARCHAR(255) DEFAULT 'none', tariff_change_date DATETIME, balans DECIMAL(18, 2) NOT NULL, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, UNIQUE INDEX user_sluggable_idx (slug), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci ENGINE = INNODB;
CREATE TABLE page (id BIGINT AUTO_INCREMENT, id_page BIGINT, title VARCHAR(100), name VARCHAR(100) NOT NULL UNIQUE, url VARCHAR(40) UNIQUE, content LONGTEXT NOT NULL, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, INDEX id_page_idx (id_page), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci ENGINE = INNODB;
CREATE TABLE paragraph (id BIGINT AUTO_INCREMENT, id_content BIGINT, paragraph_ru LONGTEXT NOT NULL, paragraph_en LONGTEXT NOT NULL, ordered INT DEFAULT 0 NOT NULL, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, INDEX id_content_idx (id_content), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci ENGINE = INNODB;
CREATE TABLE period (id BIGINT AUTO_INCREMENT, 1k DECIMAL(18, 2) NOT NULL, date VARCHAR(7) NOT NULL UNIQUE, INDEX date_idx (date), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci ENGINE = INNODB;
CREATE TABLE post (id BIGINT AUTO_INCREMENT, id_topic BIGINT, id_user BIGINT, content LONGTEXT NOT NULL, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, INDEX id_topic_idx (id_topic), INDEX id_user_idx (id_user), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci ENGINE = INNODB;
CREATE TABLE room (id BIGINT AUTO_INCREMENT, name VARCHAR(55) NOT NULL UNIQUE, description VARCHAR(255), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci ENGINE = INNODB;
CREATE TABLE setting (id BIGINT AUTO_INCREMENT, name VARCHAR(55) NOT NULL UNIQUE, value VARCHAR(255) NOT NULL, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci ENGINE = INNODB;
CREATE TABLE topic (id BIGINT AUTO_INCREMENT, id_room BIGINT, id_user BIGINT, title VARCHAR(255) NOT NULL UNIQUE, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, INDEX id_room_idx (id_room), INDEX id_user_idx (id_user), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci ENGINE = INNODB;
CREATE TABLE transaction (id BIGINT AUTO_INCREMENT, id_period BIGINT, operation VARCHAR(255) DEFAULT 'none' NOT NULL, amount DECIMAL(18, 2) NOT NULL, id_sender BIGINT, id_receiver BIGINT, sender_balance_before DECIMAL(18, 2) NOT NULL, sender_balance_after DECIMAL(18, 2) NOT NULL, receiver_balance_before DECIMAL(18, 2) NOT NULL, receiver_balance_after DECIMAL(18, 2) NOT NULL, notes VARCHAR(255) NOT NULL, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, INDEX id_period_idx (id_period), PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci ENGINE = INNODB;
CREATE TABLE user_group (id BIGINT AUTO_INCREMENT, name VARCHAR(255) UNIQUE, description VARCHAR(255), created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci ENGINE = INNODB;
CREATE TABLE user_permission (id BIGINT AUTO_INCREMENT, name VARCHAR(255) UNIQUE, description TEXT, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, PRIMARY KEY(id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci ENGINE = INNODB;
CREATE TABLE user_remember_key (id BIGINT AUTO_INCREMENT, user_id BIGINT, remember_key VARCHAR(32), ip_address VARCHAR(50), created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, INDEX user_id_idx (user_id), PRIMARY KEY(id, ip_address)) DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci ENGINE = INNODB;
CREATE TABLE user__group (user_id BIGINT, group_id BIGINT, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, PRIMARY KEY(user_id, group_id)) DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci ENGINE = INNODB;
ALTER TABLE balance_system ADD CONSTRAINT balance_system_id_period_period_id FOREIGN KEY (id_period) REFERENCES period(id) ON DELETE CASCADE;
ALTER TABLE balance_user ADD CONSTRAINT balance_user_id_user_user_id FOREIGN KEY (id_user) REFERENCES user(id) ON DELETE CASCADE;
ALTER TABLE balance_user ADD CONSTRAINT balance_user_id_period_period_id FOREIGN KEY (id_period) REFERENCES period(id) ON DELETE CASCADE;
ALTER TABLE comment ADD CONSTRAINT comment_id_paragraph_paragraph_id FOREIGN KEY (id_paragraph) REFERENCES paragraph(id);
ALTER TABLE content ADD CONSTRAINT content_id_user_user_id FOREIGN KEY (id_user) REFERENCES user(id);
ALTER TABLE content ADD CONSTRAINT content_id_category_category_id FOREIGN KEY (id_category) REFERENCES category(id);
ALTER TABLE content_purchase ADD CONSTRAINT content_purchase_id_user_user_id FOREIGN KEY (id_user) REFERENCES user(id);
ALTER TABLE content_purchase ADD CONSTRAINT content_purchase_id_content_content_id FOREIGN KEY (id_content) REFERENCES content(id);
ALTER TABLE content_purchase ADD CONSTRAINT content_purchase_id_category_category_id FOREIGN KEY (id_category) REFERENCES category(id);
ALTER TABLE user_group__user_permission ADD CONSTRAINT user_group__user_permission_permission_id_user_permission_id FOREIGN KEY (permission_id) REFERENCES user_permission(id) ON DELETE CASCADE;
ALTER TABLE user_group__user_permission ADD CONSTRAINT user_group__user_permission_group_id_user_group_id FOREIGN KEY (group_id) REFERENCES user_group(id) ON DELETE CASCADE;
ALTER TABLE page ADD CONSTRAINT page_id_page_page_id FOREIGN KEY (id_page) REFERENCES page(id);
ALTER TABLE paragraph ADD CONSTRAINT paragraph_id_content_content_id FOREIGN KEY (id_content) REFERENCES content(id);
ALTER TABLE post ADD CONSTRAINT post_id_user_user_id FOREIGN KEY (id_user) REFERENCES user(id);
ALTER TABLE post ADD CONSTRAINT post_id_topic_topic_id FOREIGN KEY (id_topic) REFERENCES topic(id);
ALTER TABLE topic ADD CONSTRAINT topic_id_user_user_id FOREIGN KEY (id_user) REFERENCES user(id);
ALTER TABLE topic ADD CONSTRAINT topic_id_room_room_id FOREIGN KEY (id_room) REFERENCES room(id);
ALTER TABLE transaction ADD CONSTRAINT transaction_id_period_period_id FOREIGN KEY (id_period) REFERENCES period(id) ON DELETE CASCADE;
ALTER TABLE user_remember_key ADD CONSTRAINT user_remember_key_user_id_user_id FOREIGN KEY (user_id) REFERENCES user(id) ON DELETE CASCADE;
ALTER TABLE user__group ADD CONSTRAINT user__group_user_id_user_id FOREIGN KEY (user_id) REFERENCES user(id) ON DELETE CASCADE;
ALTER TABLE user__group ADD CONSTRAINT user__group_group_id_user_group_id FOREIGN KEY (group_id) REFERENCES user_group(id) ON DELETE CASCADE;
